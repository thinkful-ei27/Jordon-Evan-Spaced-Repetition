(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{134:function(e,t,n){e.exports=n(248)},246:function(e,t,n){e.exports=n.p+"static/media/temp-app-preview.4e5cbf06.png"},247:function(e,t,n){},248:function(e,t,n){"use strict";n.r(t);var a,r,o=n(0),c=n.n(o),i=n(102),s=n.n(i),u=n(25),l=n(8),m=n(11),p=n(12),h=n(14),d=n(13),f=n(15),b=n(31),g=n(104),v=n.n(g),E=n(54),O=Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_API_BASE_URL||"http://localhost:8080/api",j=function(e){return e.ok?e:e.headers.has("content-type")&&e.headers.get("content-type").startsWith("application/json")?e.json().then(function(e){return Promise.reject(e)}):Promise.reject({code:e.status,message:e.statusText})},y=function(){try{localStorage.removeItem("authToken")}catch(e){}},T="SET_AUTH_TOKEN",w=function(e){return{type:T,authToken:e}},k="CLEAR_AUTH",N=function(){return{type:k}},U="AUTH_REQUEST",S=function(){return{type:U}},I="AUTH_SUCCESS",C="AUTH_ERROR",R=function(e){return{type:C,error:e}},P=function(e,t){var n,a=v()(e);t(w(e)),t((n=a.user,{type:I,currentUser:n})),function(e){try{localStorage.setItem("authToken",e)}catch(t){}}(e)},A=function(e,t){return function(n){return n(S()),fetch("".concat(O,"/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})}).then(function(e){return j(e)}).then(function(e){return e.json()}).then(function(e){var t=e.authToken;return P(t,n)}).catch(function(e){var t=401===e.code?"Incorrect username or password":"Unable to login, please try again";return n(R(e)),Promise.reject(new E.a({_error:t}))})}},_=function(){return function(e,t){e(S());var n=t().auth.authToken;return fetch("".concat(O,"/auth/refresh"),{method:"POST",headers:{Authorization:"Bearer ".concat(n)}}).then(function(e){return j(e)}).then(function(e){return e.json()}).then(function(t){var n=t.authToken;return P(n,e)}).catch(function(t){e(R(t)),e(N()),y()})}},x=function(e){function t(){return Object(m.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(p.a)(t,[{key:"logOut",value:function(){this.props.dispatch(N()),y()}},{key:"render",value:function(){var e,t=this;return this.props.loggedIn&&(e=c.a.createElement("button",{onClick:function(){return t.logOut()}},"Log out")),c.a.createElement("div",{className:"header-bar"},c.a.createElement("h1",null,"Foo App"),e)}}]),t}(c.a.Component),F=Object(l.b)(function(e){return{loggedIn:null!==e.auth.currentUser}})(x),D=n(99),L=n(100),H=n(30),B=n(105),J=function(e){function t(){return Object(m.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(p.a)(t,[{key:"componentDidUpdate",value:function(e){!e.meta.active&&this.props.meta.active&&this.input.focus()}},{key:"render",value:function(){var e,t,n=this;return this.props.meta.touched&&this.props.meta.error&&(e=c.a.createElement("div",{className:"form-error"},this.props.meta.error)),this.props.meta.touched&&this.props.meta.warning&&(t=c.a.createElement("div",{className:"form-warning"},this.props.meta.warning)),c.a.createElement("div",{className:"form-input"},c.a.createElement("label",{htmlFor:this.props.input.name},this.props.label,e,t),c.a.createElement("input",Object.assign({},this.props.input,{id:this.props.input.name,type:this.props.type,ref:function(e){return n.input=e}})))}}]),t}(c.a.Component),M=function(e){return e?void 0:"Required"},W=function(e){return""!==e.trim()?void 0:"Cannot be empty"},q=function(e){return e.trim()===e?void 0:"Cannot start or end with whitespace"},z=(a={min:10,max:72},function(e){return a.min&&e.length<a.min?"Must be at least ".concat(a.min," characters long"):a.max&&e.length>a.max?"Must be at most ".concat(a.max," characters long"):void 0}),V=(r="password",function(e,t){return r in t&&e.trim()===t[r].trim()?void 0:"Does not match"}),G=function(e){function t(){return Object(m.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(p.a)(t,[{key:"onSubmit",value:function(e){var t=this,n=e.username,a=e.password,r=e.firstName,o=e.lastName,c={username:n,password:a,firstName:r,lastName:o};return this.props.dispatch(function(e){return function(t){return fetch("".concat(O,"/users"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(e)}).then(function(e){return j(e)}).then(function(e){return e.json()}).catch(function(e){var t=e.reason,n=e.message,a=e.location;if("ValidationError"===t)return Promise.reject(new E.a(Object(B.a)({},a,n)))})}}(c)).then(function(){return t.props.dispatch(A(n,a))})}},{key:"render",value:function(){var e=this;return c.a.createElement("form",{className:"login-form",onSubmit:this.props.handleSubmit(function(t){return e.onSubmit(t)})},c.a.createElement("label",{htmlFor:"firstName"},"First name"),c.a.createElement(D.a,{component:J,type:"text",name:"firstName"}),c.a.createElement("label",{htmlFor:"lastName"},"Last name"),c.a.createElement(D.a,{component:J,type:"text",name:"lastName"}),c.a.createElement("label",{htmlFor:"username"},"Username"),c.a.createElement(D.a,{component:J,type:"text",name:"username",validate:[M,W,q]}),c.a.createElement("label",{htmlFor:"password"},"Password"),c.a.createElement(D.a,{component:J,type:"password",name:"password",validate:[M,z,q]}),c.a.createElement("label",{htmlFor:"passwordConfirm"},"Confirm password"),c.a.createElement(D.a,{component:J,type:"password",name:"passwordConfirm",validate:[M,W,V]}),c.a.createElement("button",{type:"submit",disabled:this.props.pristine||this.props.submitting},"Register"))}}]),t}(c.a.Component),K=Object(L.a)({form:"registration",onSubmitFail:function(e,t){return t(Object(H.a)("registration",Object.keys(e)[0]))}})(G);var Q=Object(l.b)(function(e){return{loggedIn:null!==e.auth.currentUser}})(function(e){return e.loggedIn?c.a.createElement(b.a,{to:"/dashboard"}):c.a.createElement("div",{className:"home"},c.a.createElement("h2",null,"Register for Foo App"),c.a.createElement(K,null),c.a.createElement(u.b,{to:"/"},"Login"))});var X=Object(l.b)(function(e){return{loggedIn:null!==e.auth.currentUser}})(function(e){return e.loggedIn?c.a.createElement(b.a,{to:"/dashboard"}):c.a.createElement("div",{className:"home"},c.a.createElement("h2",null,"Welcome to Spanish App"),c.a.createElement("div",{className:"app-preview"},c.a.createElement("img",{alt:"preivew of this page in action",src:n(246)})),c.a.createElement(Q,null),c.a.createElement(u.b,{to:"/login"},"Login"))}),Y=n(108),Z="FETCH_PROTECTED_DATA_SUCCESS",$="FETCH_PROTECTED_DATA_ERROR",ee=function(){return function(e,t){var n=t().auth.authToken;return fetch("".concat(O,"/protected"),{method:"GET",headers:{Authorization:"Bearer ".concat(n)}}).then(function(e){return j(e)}).then(function(e){return e.json()}).then(function(t){var n=t.data;return e(function(e){return{type:Z,data:e}}(n))}).catch(function(t){e({type:$,error:t})})}},te=function(e){function t(){return Object(m.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){this.props.dispatch(ee())}},{key:"render",value:function(){return c.a.createElement("div",{className:"dashboard"},c.a.createElement("div",{className:"dashboard-username"},"Username: ",this.props.username),c.a.createElement("div",{className:"dashboard-name"},"Name: ",this.props.name),c.a.createElement("div",{className:"dashboard-protected-data"},"Protected data: ",this.props.protectedData))}}]),t}(c.a.Component),ne=function(e){function t(t){var n=t.authenticating,a=t.loggedIn,r=t.error,o=Object(Y.a)(t,["authenticating","loggedIn","error"]);return n?c.a.createElement("div",null,"Logging in..."):!a||r?c.a.createElement(b.a,{to:"/"}):c.a.createElement(e,o)}var n=e.displayName||e.name||"Component";return t.displayName="RequiresLogin(".concat(n,")"),Object(l.b)(function(e,t){return{authenticating:e.auth.loading,loggedIn:null!==e.auth.currentUser,error:e.auth.error}})(t)}(Object(l.b)(function(e){var t=e.auth.currentUser;return{username:e.auth.currentUser.username,name:"".concat(t.firstName," ").concat(t.lastName),protectedData:e.protectedData.data}})(te)),ae=function(e){function t(){return Object(m.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(p.a)(t,[{key:"onSubmit",value:function(e){return this.props.dispatch(A(e.username,e.password))}},{key:"render",value:function(){var e,t=this;return this.props.error&&(e=c.a.createElement("div",{className:"form-error","aria-live":"polite"},this.props.error)),c.a.createElement("form",{className:"login-form",onSubmit:this.props.handleSubmit(function(e){return t.onSubmit(e)})},e,c.a.createElement("label",{htmlFor:"username"},"Username"),c.a.createElement(D.a,{component:J,type:"text",name:"username",id:"username",validate:[M,W]}),c.a.createElement("label",{htmlFor:"password"},"Password"),c.a.createElement(D.a,{component:J,type:"password",name:"password",id:"password",validate:[M,W]}),c.a.createElement("button",{disabled:this.props.pristine||this.props.submitting},"Log in"))}}]),t}(c.a.Component),re=Object(L.a)({form:"login",onSubmitFail:function(e,t){return t(Object(H.a)("login","username"))}})(ae),oe=function(e){function t(){return Object(m.a)(this,t),Object(h.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(p.a)(t,[{key:"componentDidUpdate",value:function(e){!e.loggedIn&&this.props.loggedIn?this.startPeriodicRefresh():e.loggedIn&&!this.props.loggedIn&&this.stopPeriodicRefresh()}},{key:"componentWillUnmount",value:function(){this.stopPeriodicRefresh()}},{key:"startPeriodicRefresh",value:function(){var e=this;this.refreshInterval=setInterval(function(){return e.props.dispatch(_())},36e5)}},{key:"stopPeriodicRefresh",value:function(){this.refreshInterval&&clearInterval(this.refreshInterval)}},{key:"render",value:function(){return c.a.createElement("div",{className:"app"},c.a.createElement(F,null),c.a.createElement(b.b,{exact:!0,path:"/",component:X}),c.a.createElement(b.b,{exact:!0,path:"/dashboard",component:ne}),c.a.createElement(b.b,{exact:!0,path:"/register",component:Q}),c.a.createElement(b.b,{exact:!0,path:"/login",component:re}))}}]),t}(c.a.Component),ce=Object(b.e)(Object(l.b)(function(e){return{hasAuthToken:null!==e.auth.authToken,loggedIn:null!==e.auth.currentUser}})(oe)),ie=n(7),se=n(101),ue=n(107),le={authToken:null,currentUser:null,loading:!1,error:null};var me={data:"",error:null};var pe=Object(ie.d)(Object(ie.c)({form:se.a,auth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:le,t=arguments.length>1?arguments[1]:void 0;return t.type===T?Object.assign({},e,{authToken:t.authToken}):t.type===k?Object.assign({},e,{authToken:null,currentUser:null}):t.type===U?Object.assign({},e,{loading:!0,error:null}):t.type===I?Object.assign({},e,{loading:!1,currentUser:t.currentUser}):t.type===C?Object.assign({},e,{loading:!1,error:t.error}):e},protectedData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:me,t=arguments.length>1?arguments[1]:void 0;return t.type===Z?Object.assign({},e,{data:t.data,error:null}):t.type===$?Object.assign({},e,{error:t.error}):e}}),Object(ie.a)(ue.a)),he=localStorage.getItem("authToken");if(he){var de=he;pe.dispatch(w(de)),pe.dispatch(_())}var fe=pe;n(247);s.a.render(c.a.createElement(l.a,{store:fe},c.a.createElement(u.a,null,c.a.createElement(ce,null))),document.getElementById("root"))}},[[134,1,2]]]);
//# sourceMappingURL=main.4db7464d.chunk.js.map